<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firestoreæ¥ç¶šãƒ†ã‚¹ãƒˆ</title>
</head>
<body>
    <h1>ğŸ”¥ Firestoreæ¥ç¶šãƒ†ã‚¹ãƒˆ</h1>
    <div id="status">ãƒ†ã‚¹ãƒˆæº–å‚™ä¸­...</div>
    <div id="results"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js'
        import { getFirestore, collection, addDoc, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js'

        // Firebaseè¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyCSoIySPtnNJHz_lN5bLSLhJrDFPfCbRsY",
            authDomain: "gemaimamastoreproject.firebaseapp.com",
            projectId: "gemaimamastoreproject",
            storageBucket: "gemaimamastoreproject.firebasestorage.app",
            messagingSenderId: "727225892227",
            appId: "1:727225892227:web:0958adf8c85a3487b30ab6",
            measurementId: "G-M3VBTG516S"
        }

        // FirebaseåˆæœŸåŒ–
        const app = initializeApp(firebaseConfig)
        const db = getFirestore(app)

        const statusDiv = document.getElementById('status')
        const resultsDiv = document.getElementById('results')

        async function testFirestore() {
            try {
                statusDiv.innerHTML = 'ğŸ”— Firestoreæ¥ç¶šä¸­...'
                
                // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
                const testProduct = {
                    id: Date.now(),
                    title: 'ãƒ†ã‚¹ãƒˆæˆæœç‰© ' + new Date().toLocaleTimeString(),
                    category: 'ãƒ†ã‚¹ãƒˆ',
                    description: 'Firestoreæ¥ç¶šãƒ†ã‚¹ãƒˆç”¨ã®ãƒ‡ãƒ¼ã‚¿ã§ã™',
                    tags: ['ãƒ†ã‚¹ãƒˆ', 'Firestore'],
                    author: {
                        name: 'ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼',
                        avatar: 'T',
                        role: 'ãƒ†ã‚¹ã‚¿ãƒ¼'
                    },
                    date: new Date().toISOString().split('T')[0],
                    likes: 0,
                    comments: 0,
                    thumbnail: 'https://via.placeholder.com/300x200/9B7BD8/FFFFFF?text=Test',
                    featured: false,
                    url: 'https://example.com'
                }

                // 1. ãƒ‡ãƒ¼ã‚¿è¿½åŠ ãƒ†ã‚¹ãƒˆ
                statusDiv.innerHTML = 'ğŸ“ ãƒ‡ãƒ¼ã‚¿è¿½åŠ ä¸­...'
                const docRef = await addDoc(collection(db, 'products'), testProduct)
                
                statusDiv.innerHTML = 'âœ… ãƒ‡ãƒ¼ã‚¿è¿½åŠ æˆåŠŸï¼'
                resultsDiv.innerHTML += `<p>âœ… è¿½åŠ ã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆID: ${docRef.id}</p>`

                // 2. ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
                statusDiv.innerHTML = 'ğŸ“– ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...'
                const querySnapshot = await getDocs(collection(db, 'products'))
                
                resultsDiv.innerHTML += `<p>ğŸ“„ productsã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å†…ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•°: ${querySnapshot.size}</p>`
                resultsDiv.innerHTML += '<h3>ğŸ“‹ ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ä¸€è¦§:</h3><ul>'
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data()
                    resultsDiv.innerHTML += `<li><strong>${data.title}</strong> - ${data.category}</li>`
                })
                
                resultsDiv.innerHTML += '</ul>'
                statusDiv.innerHTML = 'ğŸ‰ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆå®Œäº†ï¼Firestoreã¨ã®æ¥ç¶šãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚'

            } catch (error) {
                statusDiv.innerHTML = 'âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'
                resultsDiv.innerHTML = `<p style="color: red;">ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`
                console.error('Firestoreæ¥ç¶šã‚¨ãƒ©ãƒ¼:', error)
            }
        }

        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        testFirestore()
    </script>
</body>
</html>